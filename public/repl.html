<!doctype html>
<html>
  <head>
    <title>قلب REPL</title>
    <link rel="stylesheet" href="css/codemirror.css">
    <link rel="stylesheet" href="css/byblos.css">
    <style type="text/css">
    html,
    form,
    body {
        height: 100%;
        width: 100%;
        margin: 0;
        direction: rtl;
        font-size: 150%;
    }

    a {
      color: #2aa198;
    }

    /* The console container element */
    #console {
      position: absolute;
      width: 100%;
      height: 100%;
      direction: rtl;
      background-color:  #002b36;
    }
    /* The inner console element. */
    .jqconsole {
        padding: 50px;
    }
    /* The cursor. */
    .jqconsole-cursor {
        background-color: gray;
    }
    /* The cursor color when the console looses focus. */
    .jqconsole-blurred .jqconsole-cursor {
        background-color: #666;
    }
    /* The current prompt text color */
    .jqconsole-prompt {
        color: #fdf6e3;
    }
    /* The command history */
    .jqconsole-old-prompt {
        color:  #586e75;
        font-weight: normal;
    }
    /* The text color when in input mode. */
    .jqconsole-input {
        color: #dd0;
    }
    /* Previously entered input. */
    .jqconsole-old-input {
        color: #bb0;
        font-weight: normal;
    }
    /* The text color of the output. */
    .jqconsole-output {
        color: gray;
    }
    .jqconsole-warn {
        color: #cb4b16;
    }
    .parans {
      color: #6c71c4;
    }
    </style>
    <script src="js/jquery.js"></script>
    <script src="js/jqconsole.js"></script>
    <script src="js/jx.js"></script>
    <script src="js/peg.js"></script>
    <script src="js/qlb.js"></script>
    <script src="js/primitives.js"></script>
  </head>
  <body>
    <div id="console"></div>
    <script>
      Qlb.init(function () {
        function startPrompt () {
          jqconsole.Prompt(true, function (str) {
            Qlb.execute(str);
            startPrompt();
          }, function (str) {
            if (/\n\s*$/.test(str)) {
              // Empty line, don't continue.
              return false;
            } else {
              try {
                Qlb.parser.parse(str);
                return false;
              } catch (e) {
                console.log(e)
                if (/\)$/.test(str)) {
                  // Indent once.
                  return 1;
                } else {
                  // Continue line just don't indent.
                  return 0;
                }
              } 
            }
          });
        };
        var jqconsole = $('#console').jqconsole('', '>>> ');
        jqconsole.RegisterMatching('(', ')', 'parans');
        jqconsole.RegisterShortcut('C', function() {
          this.AbortPrompt();
          startPrompt();
        }); 
        jqconsole.RegisterShortcut('A', function() {
          this.MoveToStart();
        }); 
        jqconsole.RegisterShortcut('E', function() {
          this.MoveToEnd();
        }); 
        Qlb.console = {
          warn: function (str) {
            jqconsole.Write('\n' + str + '\n\n', 'jqconsole-warn', false);
          },
          log: function (str) {
            jqconsole.Write(str + '\n', 'jqconsole-output', false);
          }
        };
        Qlb.execute('(ضمن "mtfaail/mtfaail")');
        startPrompt();

        $(document).on('click', 'a.execute', function () {
          jqconsole.SetPromptText('(' + decodeURI(this.href).match(/#(.*)/)[1] + ')');
          jqconsole._HandleEnter();
        });

        $(document).on('click', 'a.load', function () {
          var url = this.href.match(/#(.*)/)[1];
          jx.load("/lib/" + url + ".qlb", function(code) {
            jqconsole.SetPromptText(code);
          }, null, false);
        }); 
      });

    </script>
  <script type="text/javascript">
    var _gauges = _gauges || [];
    (function() {
      var t   = document.createElement('script');
      t.type  = 'text/javascript';
      t.async = true;
      t.id    = 'gauges-tracker';
      t.setAttribute('data-site-id', '50df5732613f5d186c00000c');
      t.src = '//secure.gaug.es/track.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(t, s);
    })();
  </script>
  </body>
</html>